name: Unit Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/edgelesssys/edgelessrt-dev:nightly
    steps:

    - name: Check out code
      uses: actions/checkout@v2

    - name: Setup
      run: mkdir build

    - name: Build
      run: |
        cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo ..
        make
      working-directory: build

    - name: Test
      run: |
        src/tests/helloworld/testSign.sh
        src/tests/helloworld/testIDs.sh

    - name: CPack
      run: cpack -G DEB
      working-directory: build

# disabled until public
#   - name: Build artifact
#     uses: actions/upload-artifact@v2
#     with:
#       name: ego
#       path: build/*.deb
