"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[47],{6709:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>a});var n=s(4848),r=s(8453);const i={},o="Troubleshooting",l={id:"getting-started/troubleshoot",title:"Troubleshooting",description:"SGX",source:"@site/docs/getting-started/troubleshoot.md",sourceDirName:"getting-started",slug:"/getting-started/troubleshoot",permalink:"/ego/getting-started/troubleshoot",draft:!1,unlisted:!1,editUrl:"https://github.com/edgelesssys/ego/edit/master/docs/docs/getting-started/troubleshoot.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Examples",permalink:"/ego/getting-started/examples"},next:{title:"Build your app",permalink:"/ego/workflows/build"}},d={},a=[{value:"SGX",id:"sgx",level:2},{value:"Operating system",id:"operating-system",level:3},{value:"Hardware",id:"hardware",level:3},{value:"Driver",id:"driver",level:3},{value:"Required packages",id:"required-packages",level:3},{value:"non-FLC system",id:"non-flc-system",level:4},{value:"SGX device issues",id:"sgx-device-issues",level:4},{value:"Attestation",id:"attestation",level:2},{value:"FLC",id:"flc",level:3},{value:"Quote provider",id:"quote-provider",level:3},{value:"Out of memory",id:"out-of-memory",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"troubleshooting",children:"Troubleshooting"})}),"\n",(0,n.jsx)(t.h2,{id:"sgx",children:"SGX"}),"\n",(0,n.jsxs)(t.p,{children:["If EGo works in simulation mode (with ",(0,n.jsx)(t.code,{children:"OE_SIMULATION=1"}),"), but not with SGX, check the following."]}),"\n",(0,n.jsx)(t.h3,{id:"operating-system",children:"Operating system"}),"\n",(0,n.jsx)(t.p,{children:"EGo currently supports Ubuntu 20.04 and 22.04."}),"\n",(0,n.jsx)(t.h3,{id:"hardware",children:"Hardware"}),"\n",(0,n.jsx)(t.p,{children:"The hardware must support SGX and it must be enabled in the BIOS:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell-session",children:"$ sudo apt install cpuid\n$ cpuid | grep SGX\n      SGX: Software Guard Extensions supported = true\n      SGX_LC: SGX launch config supported      = true\n   SGX capability (0x12/0):\n      SGX1 supported                         = true\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"SGX: Software Guard Extensions supported"})," is true if the hardware supports it."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"SGX_LC: SGX launch config supported"})," is true if the hardware also supports FLC. This is required for attestation."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"SGX1 supported"})," is true if it's enabled in the BIOS."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"driver",children:"Driver"}),"\n",(0,n.jsx)(t.p,{children:"The SGX driver exposes a device:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ls /dev/*sgx*\n"})}),"\n",(0,n.jsx)(t.p,{children:"If the output is empty, install the driver."}),"\n",(0,n.jsxs)(t.p,{children:["If your system ",(0,n.jsx)(t.a,{href:"#hardware",children:"supports FLC"}),", make sure your Linux kernel is version 5.11 or newer.\nYou can check with ",(0,n.jsx)(t.code,{children:"uname -r"}),".\nIf you can't upgrade your kernel, you may ",(0,n.jsxs)(t.a,{href:"https://download.01.org/intel-sgx/latest/linux-latest/docs/Intel_SGX_SW_Installation_Guide_for_Linux.pdf",children:["install the ",(0,n.jsx)(t.em,{children:"DCAP driver"})]})," instead."]}),"\n",(0,n.jsxs)(t.p,{children:["On systems without FLC support, you need the SGX ",(0,n.jsx)(t.em,{children:"out-of-tree driver"}),".\nNote that Intel deprecated this kind of SGX implementation and EGo doesn't support remote attestation on such systems.\nTo install the driver, follow the ",(0,n.jsx)(t.a,{href:"https://download.01.org/intel-sgx/latest/linux-latest/docs/Intel_SGX_SW_Installation_Guide_for_Linux.pdf",children:"SGX installation guide from Intel"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"required-packages",children:"Required packages"}),"\n",(0,n.jsx)(t.h4,{id:"non-flc-system",children:"non-FLC system"}),"\n",(0,n.jsxs)(t.p,{children:["If your system doesn't support FLC, install the ",(0,n.jsx)(t.code,{children:"libsgx-launch"})," package:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'sudo mkdir -p /etc/apt/keyrings\nwget -qO- https://download.01.org/intel-sgx/sgx_repo/ubuntu/intel-sgx-deb.key | sudo tee /etc/apt/keyrings/intel-sgx-keyring.asc > /dev/null\necho "deb [signed-by=/etc/apt/keyrings/intel-sgx-keyring.asc arch=amd64] https://download.01.org/intel-sgx/sgx_repo/ubuntu $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/intel-sgx.list\nsudo apt update\nsudo apt install libsgx-launch\n'})}),"\n",(0,n.jsx)(t.h4,{id:"sgx-device-issues",children:"SGX device issues"}),"\n",(0,n.jsxs)(t.p,{children:["If the ",(0,n.jsx)(t.a,{href:"#driver",children:"SGX device exists"}),", but you get one of these errors:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"Failed to open Intel SGX device."})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.code,{children:"ERROR: enclave_load_data failed (addr=0x..., prot=0x1, err=0x1001) (oe_result_t=OE_PLATFORM_ERROR)"})}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Install the ",(0,n.jsx)(t.code,{children:"libsgx-enclave-common"})," package:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:'sudo mkdir -p /etc/apt/keyrings\nwget -qO- https://download.01.org/intel-sgx/sgx_repo/ubuntu/intel-sgx-deb.key | sudo tee /etc/apt/keyrings/intel-sgx-keyring.asc > /dev/null\necho "deb [signed-by=/etc/apt/keyrings/intel-sgx-keyring.asc arch=amd64] https://download.01.org/intel-sgx/sgx_repo/ubuntu $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/intel-sgx.list\nsudo apt update\nsudo apt install --no-install-recommends libsgx-enclave-common\n'})}),"\n",(0,n.jsx)(t.h2,{id:"attestation",children:"Attestation"}),"\n",(0,n.jsxs)(t.p,{children:["If EGo works in SGX mode (i.e., without ",(0,n.jsx)(t.code,{children:"OE_SIMULATION"}),"), but attestation fails, check the following."]}),"\n",(0,n.jsx)(t.h3,{id:"flc",children:"FLC"}),"\n",(0,n.jsxs)(t.p,{children:["Attestation only works on ",(0,n.jsx)(t.a,{href:"#hardware",children:"SGX-FLC"})," systems."]}),"\n",(0,n.jsx)(t.h3,{id:"quote-provider",children:"Quote provider"}),"\n",(0,n.jsxs)(t.p,{children:["You must install a ",(0,n.jsx)(t.a,{href:"/ego/reference/attest",children:"quote provider"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"out-of-memory",children:"Out of memory"}),"\n",(0,n.jsxs)(t.p,{children:["The amount of available memory to an SGX enclave is set when signing the binary.\nIf you get a memory allocation error, try to increase the ",(0,n.jsx)(t.code,{children:"heapSize"})," in ",(0,n.jsx)(t.a,{href:"/ego/reference/config",children:"enclave.json"})," and sign the binary again.\nNote that the runtime itself also occupies memory and that the Go allocator may pre-allocate more memory than is currently in use.\nThus, you usually have to give your enclave more memory than actually used by your app."]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>l});var n=s(6540);const r={},i=n.createContext(r);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);